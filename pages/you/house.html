<template>
  <div id="house">
    <div class="text-form">
      <h2>Your Home</h2>
      <p>
        Ownership: 
        <select id="ownership">
          <option value="rent">Paying rent</option>
          <option value="mortgage">Paying mortgage</option>
          <option value="own" selected="selected">Own</option>
          <option value="share">Own (shared)</option>
          <option value="rent-free">Staying rent free</option>
          <option value="none">No housing</option>
        </select>
      </p>
      <p>
        Home type: 
        <select id="home_type">
          <option>House</option>
          <option>Apartment</option>
          <option>Duplex</option>
        </select>
      </p>
      <p>Landlord: <input id="landlord" /></p>
      <hr/>
      <h3>Utilities</h3>
      <p>Electric: <input id="electric" /></p>
      <p>Water: <input id="water" /></p>
      <p>Internet: <input id="internet" /></p>
      <p>Gas: <input id="gas" /></p>
      <hr />
      <h3>Address</h3>
      <p>Street address: <input id="street" /></p>
      <p>City: <input id="city" /></p>
      <p>State: <input id="state" /></p>
      <p>Zip code: <input id="zip" /></p>
      <hr />
      <h3>More location info</h3>
      <p>County: <input id="county" /></p>
      <p>Country: <input id="country" /></p>
      <p>Timezone: <input id="timezone" /></p>
      <p>Coordinates: <input id="coordinates" /></p>
    </div>
    <button onclick="update_house()">
      Update house info
    </button>
  </div>
</template>

<script>
  function load_house() {
    const http = new XMLHttpRequest();
    http.open("POST", "/api/user-house-by-user");
    http.send(_current_user.id.toString());
    http.onreadystatechange = (e) => {
      if (http.readyState == 4 && http.status == 200) {
        let response = JSON.parse(http.responseText);
        document.getElementById('ownership').value = response.ownership;
        document.getElementById('home_type').value = response.home_type;
        document.getElementById('landlord').value = response.landlord;
        document.getElementById('electric').value = response.electric;
        document.getElementById('water').value = response.water;
        document.getElementById('internet').value = response.internet;
        document.getElementById('gas').value = response.gas;
        document.getElementById('street').value = response.street;
        document.getElementById('city').value = response.city;
        document.getElementById('state').value = response.state;
        document.getElementById('zip').value = response.zip;
        document.getElementById('county').value = response.county;
        document.getElementById('country').value = response.country;
        document.getElementById('timezone').value = response.timezone;
        document.getElementById('coordinates').value = response.coordinates;
      }
    }
  }
  load_house();

  function update_house() {
    let ownership = document.getElementById('ownership').value;
    let home_type = document.getElementById('home_type').value;
    let landlord = document.getElementById('landlord').value;
    let electric = document.getElementById('electric').value;
    let water = document.getElementById('water').value;
    let internet = document.getElementById('internet').value;
    let gas = document.getElementById('gas').value;
    let street = document.getElementById('street').value;
    let city = document.getElementById('city').value;
    let state = document.getElementById('state').value;
    let zip = document.getElementById('zip').value;
    let county = document.getElementById('county').value;
    let country = document.getElementById('country').value;
    let timezone = document.getElementById('timezone').value;
    let coordinates = document.getElementById('coordinates').value;
    
    if (!_current_user || !_current_user.id) {
      document.getElementById('error').innerHTML = 'Must be logged in..';
      return;
    }

    const http = new XMLHttpRequest();
    http.open("POST", "/api/update-user-house");
    http.send(JSON.stringify({
      user_id: _current_user.id,
      ownership,
      home_type,
      landlord,
      electric,
      water,
      internet,
      gas,
      street,
      city,
      state,
      zip,
      county,
      country,
      timezone,
      coordinates
    }));
    http.onreadystatechange = (e) => {
      console.log(http.responseText)
      let response;      
      if (http.readyState == 4 && http.status == 200) {
        console.log("Response recieved! Updated your user-house.")
      } else {
        document.getElementById('error').innerHTML = "Error updating job info.";
      }
    }
  }
</script>