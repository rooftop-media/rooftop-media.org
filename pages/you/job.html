<template>
  <div id="job">
    <div class="text-form">
      <h2>Your Job</h2>
      <p>Workplace: <input id="workplace" /></p>
      <p>Position: <input id="position" /></p>
      <hr/>
      <p>Workplace phone: <input id="phone" /></p>
      <p>Workplace Email: <input id="email" /></p>
      <hr />
      <p>Schedule: <input id="schedule" /></p>
      <hr />
      <p>Ave. hours a week: <input id="hours" /></p>
      <p>Hourly wage: <input id="wage" /></p>
      <p>Yearly salary: <input id="salary" /></p>
      <div id="error"></div>
    </div>
    <button onclick="update_job()">
      Update job info
    </button>
  </div>
</template>

<script>
  function load_job() {
    const http = new XMLHttpRequest();
    http.open("POST", "/api/user-job-by-user");
    http.send(_current_user.id.toString());
    http.onreadystatechange = (e) => {
      if (http.readyState == 4 && http.status == 200) {
        let response = JSON.parse(http.responseText);
        document.getElementById('workplace').value = response.workplace;
        document.getElementById('position').value = response.position;
        document.getElementById('phone').value = response.phone;
        document.getElementById('email').value = response.email;
        document.getElementById('schedule').value = response.schedule;
        document.getElementById('hours').value = response.hours;
        document.getElementById('wage').value = response.wage;
        document.getElementById('salary').value = response.salary;
      }
    }
  }
  load_job();

  function update_job() {
    let workplace = document.getElementById('workplace').value;
    let position = document.getElementById('position').value;
    let phone = document.getElementById('phone').value;
    let email = document.getElementById('email').value;
    let schedule = document.getElementById('schedule').value;
    let hours = document.getElementById('hours').value;
    let wage = document.getElementById('wage').value;
    let salary = document.getElementById('salary').value;
    
    if (!_current_user || !_current_user.id) {
      document.getElementById('error').innerHTML = 'Must be logged in..';
      return;
    }

    const http = new XMLHttpRequest();
    http.open("POST", "/api/update-user-job");
    http.send(JSON.stringify({
      user_id: _current_user.id,
      workplace,
      position,
      phone,
      email,
      schedule,
      hours,
      wage,
      salary
    }));
    http.onreadystatechange = (e) => {
      console.log(http.responseText)
      let response;      
      if (http.readyState == 4 && http.status == 200) {
        console.log("Response recieved! Updated your user-job.")
      } else {
        document.getElementById('error').innerHTML = "Error updating job info.";
      }
    }
  }
</script>